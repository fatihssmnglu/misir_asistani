{% extends 'base.html' %}
{% block content %}
<div class="container mt-4">
  <h3>📜 Sözleşmelerim</h3>

  <h5 class="mt-3 text-success">Alıcı Olduğum</h5>
  {% for c in buyer_contracts %}
  <div class="card my-2 p-3">
    <b>{{ c.listing.product }}</b> — {{ c.quantity }} ton @ {{ c.offered_price }} ₺/ton
    <div class="mt-2">
      {% if not c.contract_signed %}
        <a href="{% url 'sign_contract' c.id %}" class="btn btn-outline-primary btn-sm">📝 Sözleşmeyi Onayla</a>
      {% elif c.payment_status == 'pending' %}
        <a href="{% url 'payment_page' c.id %}" class="btn btn-success btn-sm">💳 Ödeme Yap</a>
      {% elif c.payment_status == 'in_escrow' and not c.delivery_confirmed %}
        <a href="{% url 'confirm_delivery' c.id %}" class="btn btn-warning btn-sm">📦 Teslimi Onayla</a>
      {% endif %}
    </div>
  </div>
  {% empty %}<p>Henüz yok.</p>{% endfor %}

  <hr>

  <h5 class="mt-4 text-info">Satıcı Olduğum</h5>
  {% for c in seller_contracts %}
  <div class="card my-2 p-3">
    <b>{{ c.listing.product }}</b> — {{ c.quantity }} ton @ {{ c.offered_price }} ₺/ton
    <div class="mt-2">
      {% if c.payment_status == 'in_escrow' and not c.shipped_at %}
        <a href="{% url 'mark_shipped' c.id %}" class="btn btn-primary btn-sm">🚚 Sevkiyeti Başlat</a>
      {% endif %}
    </div>
  </div>
  {% empty %}<p>Henüz yok.</p>{% endfor %}
</div>
{% endblock %}
